# Performance Reviews

This directory contains performance benchmarking data and reviews for the Teqniqly.Sluggo library.

## Directory Structure

```text
performance_reviews/
├── baselines/
│   └── baseline-current.json      # Current performance baseline
├── nightly/
│   └── performance-review-*.md    # Nightly performance review reports
└── README.md                       # This file
```

## Baselines

The `baselines` directory contains the current performance baseline used for comparison in nightly benchmark runs.

### baseline-current.json

This file contains the approved performance baseline metrics for both CPU and memory benchmarks. It includes:

-   **date**: When the baseline was established
-   **commit**: Git commit SHA of the baseline
-   **runtime**: .NET runtime version
-   **cpu_benchmarks**: Array of CPU benchmark results
-   **memory_benchmarks**: Array of memory benchmark results

The baseline is automatically updated by the nightly performance workflow when no regressions are detected.

## Nightly Reviews

The `nightly` directory contains performance review reports generated by the automated nightly benchmark workflow.

Each review file follows the naming pattern: `performance-review-YYYY-MM-DD.md`

### Review Contents

Each nightly review includes:

1.   **Summary**: Overview of total benchmarks, regressions, and improvements
2.   **CPU Benchmarks Table**: Comparison of execution times against baseline
3.   **Memory Benchmarks Table**: Comparison of allocations and GC collections against baseline
4.   **Regressions Section**: Detailed analysis of any performance regressions found
5.   **Action Items**: Required actions based on the review results
6.   **Conclusion**: Overall assessment and next steps

## Regression Criteria

Performance changes are classified using these thresholds:

### CPU Performance

-   **Critical Regression**: >20% slower
-   **Major Regression**: 10-20% slower
-   **Minor Regression**: 5-10% slower
-   **No Significant Change**: <5% difference
-   **Improvement**: Any measurable speedup

### Memory Performance

-   **Critical Regression**: >20% more allocations OR Gen2 collections increase
-   **Major Regression**: 10-20% more allocations OR Gen1 collections increase
-   **Minor Regression**: 5-10% more allocations
-   **No Significant Change**: <5% difference
-   **Improvement**: Any measurable reduction in allocations or GC pressure

## Automated Workflow

The nightly performance workflow runs automatically every night at 2:00 AM UTC on the main branch. It:

1.   Runs the full benchmark suite
2.   Compares results against the current baseline
3.   Generates a detailed performance review
4.   **If no regressions**: Updates the baseline automatically
5.   **If regressions found**: Creates a GitHub issue with regression details

## Manual Baseline Updates

If a regression is found and accepted, the baseline can be manually updated:

1.   Review the regression details in the generated issue
2.   If the regression is justified (e.g., due to intentional feature changes), manually update `baselines/baseline-current.json`
3.   Commit the updated baseline with a descriptive message explaining the justification

## Viewing Historical Trends

All nightly review files are retained in the repository, allowing you to:

-   Track performance trends over time
-   Identify gradual performance degradation
-   Correlate performance changes with code changes
-   Verify that performance improvements persist

## Related Documentation

-   [Benchmark Project README](../Teqniqly.Sluggo.Benchmarks/README.md) - How to run benchmarks locally
-   [Performance Review Workflow](../.clinerules/performance-review-workflow.md) - Detailed workflow documentation
-   [Nightly Performance Workflow](../.github/workflows/nightly-performance.yml) - Automated workflow configuration
